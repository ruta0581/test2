<!-- cliant-media.html：シンプルにmediaのみ受信 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>RemotePad メディア受信</title>
  <style>
    body { background: #222; }
    #remoteVideo { width: 80vw; max-width: 1280px; margin: 40px auto; display: block; background: #000; border-radius: 16px; }
  </style>
</head>
<body>
  <video id="remoteVideo" autoplay playsinline controls></video>
<script>
let ws = new WebSocket("wss://temporary-signed-fares-fun.trycloudflare.com/ws:8082/ws-media");
let pc = null;
ws.onmessage = async ev => {
  const msg = JSON.parse(ev.data);
  if (msg.type === "offer") {
    pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
    pc.ontrack = (e) => {
      document.getElementById('remoteVideo').srcObject = e.streams[0];
    };
    pc.onicecandidate = e => {
      if (e.candidate) ws.send(JSON.stringify({ type: "candidate", candidate: e.candidate }));
    };
    await pc.setRemoteDescription(msg.offer);
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    ws.send(JSON.stringify({ type: "answer", answer }));
  } else if (msg.type === "candidate" && pc) {
    await pc.addIceCandidate(new RTCIceCandidate(msg.candidate));
  }
};
</script>
</body>
</html>
